{
  "openapi": "3.0.2",
  "info": {
    "title": "Barcode Buddy",
    "version": "1.0.2",
    "description": "BarcodeBuddy API",
    "license": {
      "name": "GNU GPLv3",
      "url": "https://www.gnu.org/licenses/gpl.txt"
    }
  },
  "paths": {
    "/system/info": {
      "get": {
        "tags": [
          "system"
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "version": {
                          "type": "string"
                        },
                        "version_int": {
                          "type": "string"
                        }
                      }
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "data": {
                    "version": "1.4.1.1",
                    "version_int": "1411"
                  },
                  "result": {
                    "result": "OK",
                    "http_code": 200
                  }
                }
              }
            },
            "description": "Response"
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Returns version number"
      }
    },
    "/system/barcodes": {
      "get": {
        "tags": [
          "system"
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "BARCODE_C": {
                          "type": "string"
                        },
                        "BARCODE_CS": {
                          "type": "string"
                        },
                        "BARCODE_P": {
                          "type": "string"
                        },
                        "BARCODE_O": {
                          "type": "string"
                        },
                        "BARCODE_GS": {
                          "type": "string"
                        },
                        "BARCODE_Q": {
                          "type": "string"
                        },
                        "BARCODE_AS": {
                          "type": "string"
                        },
                        "BARCODE_CA": {
                          "type": "string"
                        }
                      }
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": {
                      "BARCODE_C": "BBUDDY-C",
                      "BARCODE_CS": "BBUDDY-CS",
                      "BARCODE_P": "BBUDDY-P",
                      "BARCODE_O": "BBUDDY-O",
                      "BARCODE_GS": "BBUDDY-I",
                      "BARCODE_Q": "BBUDDY-Q-",
                      "BARCODE_AS": "BBUDDY-AS",
                      "BARCODE_CA": "BBUDDY-CA"
                    },
                    "result": {
                      "result": "OK",
                      "http_code": 200
                    }
                  }
                }
              }
            },
            "description": "Response"
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Returns all special barcodes"
      }
    },
    "/system/unknownbarcodes": {
      "get": {
        "tags": [
          "system"
        ],
        "parameters": [
          {
            "name": "lookup",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["true", "false", "1", "0"]
            },
            "description": "If 'true' or '1', performs Open Food Facts lookup for each barcode and includes product_info in response"
          }
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "count": {
                          "format": "int32",
                          "type": "integer",
                          "description": "Number of unknown barcodes"
                        },
                        "barcodes": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "barcode": {
                                "type": "string",
                                "description": "The barcode value"
                              },
                              "amount": {
                                "format": "int32",
                                "type": "integer",
                                "description": "Number of times this barcode was scanned"
                              },
                              "product_info": {
                                "type": "object",
                                "nullable": true,
                                "description": "Product info from Open Food Facts (only present when lookup=true)",
                                "properties": {
                                  "name": {
                                    "type": "string",
                                    "nullable": true,
                                    "description": "Product name"
                                  },
                                  "brand": {
                                    "type": "string",
                                    "nullable": true,
                                    "description": "Brand name"
                                  },
                                  "image_url": {
                                    "type": "string",
                                    "nullable": true,
                                    "description": "URL to product image"
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  }
                },
                "examples": {
                  "without_lookup": {
                    "summary": "Response without lookup",
                    "value": {
                      "data": {
                        "count": 2,
                        "barcodes": [
                          {
                            "barcode": "TEST123",
                            "amount": 1
                          },
                          {
                            "barcode": "5061060344584",
                            "amount": 7
                          }
                        ]
                      },
                      "result": {
                        "result": "OK",
                        "http_code": 200
                      }
                    }
                  },
                  "with_lookup": {
                    "summary": "Response with lookup=true",
                    "value": {
                      "data": {
                        "count": 2,
                        "barcodes": [
                          {
                            "barcode": "TEST123",
                            "amount": 1,
                            "product_info": null
                          },
                          {
                            "barcode": "5061060344584",
                            "amount": 7,
                            "product_info": {
                              "name": "Organic Olive Oil",
                              "brand": "Example Brand",
                              "image_url": "https://images.openfoodfacts.org/images/products/example.jpg"
                            }
                          }
                        ]
                      },
                      "result": {
                        "result": "OK",
                        "http_code": 200
                      }
                    }
                  }
                }
              }
            },
            "description": "Response"
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Returns all unknown barcodes with their scanned amounts. Optionally includes Open Food Facts product lookup."
      }
    },
    "/state/getmode": {
      "description": "STATE_CONSUME         = 0;\nSTATE_CONSUME_SPOILED = 1;\nSTATE_PURCHASE        = 2;\nSTATE_OPEN            = 3;\nSTATE_GETSTOCK        = 4;\nSTATE_ADD_SL          = 5;",
      "get": {
        "tags": [
          "state"
        ],
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "mode": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": {
                      "mode": 0
                    },
                    "result": {
                      "result": "OK",
                      "http_code": 200
                    }
                  }
                }
              }
            },
            "description": "STATE_CONSUME = 0; \nSTATE_CONSUME_SPOILED = 1; \nSTATE_PURCHASE = 2; \nSTATE_OPEN = 3;\nSTATE_GETSTOCK = 4; \nSTATE_ADD_SL = 5; \nSTATE_CONSUME_ALL = 6;"
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Returns current mode"
      }
    },
    "/state/setmode": {
      "post": {
        "requestBody": {
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "state": {
                    "description": "STATE_CONSUME = 0; \nSTATE_CONSUME_SPOILED = 1; \nSTATE_PURCHASE = 2; \nSTATE_OPEN = 3;\nSTATE_GETSTOCK = 4; \nSTATE_ADD_SL = 5; \nSTATE_CONSUME_ALL = 6;",
                    "type": "integer"
                  }
                },
                "required": [
                  "state"
                ]
              },
              "examples": {
                "Set_Consume": {
                  "value": 0
                }
              }
            }
          },
          "required": true
        },
        "tags": [
          "state"
        ],
        "responses": {
          "200": {
            "description": "Mode set successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "string"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "OK",
                      "http_code": 200
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error if invalid state int supplied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "Invalid state provided",
                      "http_code": 400
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Sets current mode"
      }
    },
    "/action/scan": {
      "post": {
        "tags": [
          "action"
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "barcode": {
                    "type": "string"
                  },
                  "price": {
                    "type": "number"
                  },
                  "bestBeforeInDays": {
                    "type": "integer",
                    "description": "The amount of days from today until the item expires"
                  }
                },
                "required": [
                  "barcode"
                ]
              },
              "examples": {
                "Send_123456": {
                  "value": "123456"
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Scan successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        }
                      }
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": {
                      "result": "Unknown barcode looked up, found name: Olive Oil. Barcode: 123456789"
                    },
                    "result": {
                      "result": "OK",
                      "http_code": 200
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error if no barcode supplied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "No barcode supplied",
                      "http_code": 400
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Passes a barcode to Barcode Buddy"
      }
    },
    "/action/deleteunknown": {
      "post": {
        "tags": [
          "action"
        ],
        "requestBody": {
          "content": {
            "application/x-www-form-urlencoded": {
              "schema": {
                "type": "object",
                "properties": {
                  "barcode": {
                    "type": "string",
                    "description": "The barcode to remove from the unknown list"
                  }
                },
                "required": [
                  "barcode"
                ]
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Barcode deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "deleted": {
                          "type": "boolean",
                          "description": "True if the barcode was deleted"
                        }
                      }
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": {
                      "deleted": true
                    },
                    "result": {
                      "result": "OK",
                      "http_code": 200
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error if no barcode supplied",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "No barcode supplied",
                      "http_code": 400
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Barcode not found in unknown list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "Barcode not found in unknown list",
                      "http_code": 404
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Removes a barcode from the unknown list"
      }
    },
    "/action/associatebarcode": {
      "post": {
        "tags": [
          "action"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "barcode": {
                    "type": "string",
                    "description": "The barcode to associate with a Grocy product"
                  },
                  "product_id": {
                    "type": "integer",
                    "description": "The Grocy product ID to associate the barcode with"
                  }
                },
                "required": [
                  "barcode",
                  "product_id"
                ]
              },
              "example": {
                "barcode": "5061060344584",
                "product_id": 123
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Barcode associated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "barcode": {
                          "type": "string",
                          "description": "The barcode that was associated"
                        },
                        "product_id": {
                          "type": "integer",
                          "description": "The Grocy product ID"
                        },
                        "product_name": {
                          "type": "string",
                          "description": "The name of the Grocy product"
                        },
                        "stock_added": {
                          "type": "integer",
                          "description": "Amount of stock added to Grocy"
                        }
                      }
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": {
                      "barcode": "5061060344584",
                      "product_id": 123,
                      "product_name": "Olive Oil",
                      "stock_added": 7
                    },
                    "result": {
                      "result": "OK",
                      "http_code": 200
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Missing or invalid parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "No barcode supplied",
                      "http_code": 400
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Barcode or product not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "Barcode not found in unknown list",
                      "http_code": 404
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Failed to add barcode to Grocy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "Failed to add barcode to Grocy: error details",
                      "http_code": 500
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Associates an unknown barcode with an existing Grocy product and adds the scanned quantity to stock"
      }
    },
    "/action/createandassociate": {
      "post": {
        "tags": [
          "action"
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "barcode": {
                    "type": "string",
                    "description": "The barcode to associate with the new product"
                  },
                  "name": {
                    "type": "string",
                    "description": "Name for the new Grocy product"
                  },
                  "product_group_id": {
                    "type": "integer",
                    "description": "Optional Grocy product group ID"
                  },
                  "location_id": {
                    "type": "integer",
                    "description": "Optional Grocy location ID"
                  }
                },
                "required": [
                  "barcode",
                  "name"
                ]
              },
              "example": {
                "barcode": "5061060344584",
                "name": "Organic Olive Oil",
                "product_group_id": 5,
                "location_id": 1
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Product created and barcode associated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object",
                      "properties": {
                        "barcode": {
                          "type": "string",
                          "description": "The barcode that was associated"
                        },
                        "product_id": {
                          "type": "integer",
                          "description": "The newly created Grocy product ID"
                        },
                        "product_name": {
                          "type": "string",
                          "description": "The name of the new product"
                        },
                        "stock_added": {
                          "type": "integer",
                          "description": "Amount of stock added to Grocy"
                        }
                      }
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": {
                      "barcode": "5061060344584",
                      "product_id": 456,
                      "product_name": "Organic Olive Oil",
                      "stock_added": 7
                    },
                    "result": {
                      "result": "OK",
                      "http_code": 200
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Missing or invalid parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "No product name supplied",
                      "http_code": 400
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Barcode not found in unknown list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "Barcode not found in unknown list",
                      "http_code": 404
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Failed to create product in Grocy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "object"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "result": {
                          "type": "string"
                        },
                        "http_code": {
                          "format": "int32",
                          "type": "integer"
                        }
                      }
                    }
                  },
                  "example": {
                    "data": null,
                    "result": {
                      "result": "Failed to create product in Grocy: error details",
                      "http_code": 500
                    }
                  }
                }
              }
            }
          }
        },
        "security": [
          {
            "apikey": []
          }
        ],
        "summary": "Creates a new Grocy product and associates the barcode with it, adding the scanned quantity to stock"
      }
    }
  },
  "components": {
    "securitySchemes": {
      "apikey": {
        "type": "apiKey",
        "description": "API key provided by UI",
        "name": "BBUDDY-API-KEY",
        "in": "header"
      }
    }
  },
  "security": [
    {
      "apikey": []
    }
  ],
  "tags": [
    {
      "name": "system",
      "description": ""
    },
    {
      "name": "action",
      "description": ""
    },
    {
      "name": "state",
      "description": ""
    }
  ],
  "servers": [
    {
      "url": "/api/",
      "description": "Target server"
    }
  ]
}
